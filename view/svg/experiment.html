<!-- Copyright 2017 Google Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License. -->
<!doctype html>
<html>
<head>
    <title>Test SVG</title>
</head>

<body>
<svg id="diagram" width="800" height="800" viewBox="0 0 800 800">
    <g id="blue" transform="translate(100, 100)">
        <circle cx="80" cy="-4" r="4" />
        <circle cx="80" cy="54" r="4" />
        <rect width="160" height="50" style="fill: #eff; stroke: #355; stroke-width:1" />
        <text x="80" y="30" text-anchor="middle" font-family="Go" font-size="16" style="user-select: none; pointer-events: none">
            Hello! Yes,
        </text>
    </g>
    <g id="red" transform="translate(100, 200)">
        <circle cx="80" cy="-4" r="4" />
        <circle cx="80" cy="54" r="4" />
        <rect width="160" height="50" style="fill: #fee; stroke: #533; stroke-width:1" />
        <text x="80" y="30" text-anchor="middle" font-family="Go" font-size="16" style="user-select: none; pointer-events: none">
            this is dog
        </text>
    </g>
    <path id="conn" d="M 180 154 C 180 174, 180 176, 180 196" stroke-width="2" stroke="#000" fill="transparent" />
</svg>

<script>
    var diagram = document.getElementById('diagram');

    var blue = document.getElementById('blue');
    var red = document.getElementById('red');
    var conn = document.getElementById('conn');

    var on = null;
    var relX, relY;

    function moveListener(obj) {
        return function (e) {
            on = obj;
            var tf = on.transform.baseVal.getItem(0);
            relX = e.clientX - tf.matrix.e;
            relY = e.clientY - tf.matrix.f;
        }
    }

    // Only move nodes when dragging the rectangle.
    blue.getElementsByTagName('rect')[0].addEventListener('mousedown', moveListener(blue));
    red.getElementsByTagName('rect')[0].addEventListener('mousedown', moveListener(red));

    function moveOn(e) {
        var tf = on.transform.baseVal.getItem(0).matrix;
        tf.e = e.clientX - relX;
        tf.f = e.clientY - relY;

        var bf = blue.transform.baseVal.getItem(0).matrix;
        var rf = red.transform.baseVal.getItem(0).matrix;
        conn.setAttribute('d', `M ${bf.e + 80} ${bf.f + 54} C ${bf.e + 80} ${bf.f + 104}, ${rf.e + 80} ${rf.f - 54}, ${rf.e + 80} ${rf.f - 4}`)
    }

    diagram.addEventListener('mousemove', function (e) {
        if (!on) {
            return;
        }
        moveOn(e);
    })
    diagram.addEventListener('mouseup', function (e) {
        if (!on) {
            return;
        }
        moveOn(e);
        on = null;
    })
</script>
</body>
</html>